<!-- templates/export/payroll_processing.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payroll Processing - {{ selected_date }}</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- For better PDF rendering, include Bootstrap CSS inline -->
    <style>
        /* Include Bootstrap CSS here for PDF generation */
        @import url('https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css');
        
        @page {
            size: A4;
            margin: 20mm 15mm;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #333;
        }
        
        .payslip-card {
            page-break-after: always;
        }
        
        .payslip-card:last-child {
            page-break-after: avoid;
        }
        
        /* Ensure tables don't break across pages */
        table {
            page-break-inside: avoid;
        }
        
        /* Logo styling */
        .logo-header img {
            max-width: 80px;
            height: auto;
        }
        
        /* Make cards look good in PDF */
        .card {
            border: 1px solid #dee2e6 !important;
            box-shadow: 0 0.125rem 0.25rem rgba(0,0,0,0.075) !important;
        }
        
        /* Ensure colors print well */
        .text-primary {
            color: #0d6efd !important;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        
        .text-success {
            color: #198754 !important;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        
        .text-danger {
            color: #dc3545 !important;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        
        .table-striped > tbody > tr:nth-of-type(odd) > * {
            background-color: #f8f9fa !important;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        
        /* Professional header styling */
        .payslip-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px 10px 0 0;
            margin: -20px -20px 20px -20px;
        }
        
        .payslip-header h3 {
            color: white !important;
        }
        
        .payslip-header h5 {
            color: rgba(255,255,255,0.9) !important;
        }
    </style>
</head>
<body>
    {% if payrolls %}
        <div class="payslips-container">
            <h5 class="mb-3 text-primary">Generated Payslips ({{ payrolls|length }} staff)</h5>
            {% for payroll_data in payrolls %}
                <div class="payslip-card mb-4">
                    <div class="card shadow border-0 p-3">
                        <div class="card-body">
                            <div class="text-center mb-4 logo-header">
                                <img src="{{ request.build_absolute_uri }}/media/images/fav.png" alt="Logo" class="mb-2">
                                <h3 class="fw-bold text-uppercase">Central University</h3>
                                <h5 class="text-muted">Payslip for {{ payroll_data.month }}</h5>
                            </div>

                            <hr class="my-4"/>
                            
                            <!-- Employee Information Section -->
                            <div class="row mb-3">
                                <div class="col-md-4 mb-2">
                                    <p class="mb-1"><strong>Name:</strong> {{ payroll_data.staff.title }} {{ payroll_data.staff.fname }} {{ payroll_data.staff.lname }} {{ payroll_data.staff.middlenames }}</p>
                                    <p class="mb-1"><strong>Employee ID:</strong> {{ payroll_data.staff.staffno }}</p>                    
                                </div>
                                <div class="col-md-4 mb-2">
                                    <p class="mb-1"><strong>SS No.:</strong> {{ payroll_data.staff.ssnitno|default:'' }}</p>
                                    <p class="mb-1"><strong>Job Title:</strong> {{ payroll_data.company_info.job_title|default:'' }}</p>
                                </div>
                                <div class="col-md-4 mb-2">
                                    <p class="mb-1"><strong>Grade:</strong> {{ payroll_data.company_info.job_title|default:'' }}</p>
                                    <p class="mb-1"><strong>Notch:</strong> {{ payroll_data.company_info.notch|default:'' }}</p>                
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-4 mb-2">
                                    <p class="mb-1"><strong>Bank:</strong> {{ payroll_data.company_info.bank_name|default:'' }}</p>
                                    <p class="mb-1"><strong>Bank Branch:</strong> {{ payroll_data.company_info.bank_branch|default:'' }}</p>
                                </div>
                                <div class="col-md-4 mb-2">
                                    <p class="mb-1"><strong>Bank A/C No:</strong> {{ payroll_data.company_info.accno|default:'' }}</p>
                                    <p class="mb-1"><strong>Email Address:</strong> {{ payroll_data.company_info.email|default:'' }}</p>
                                </div>
                                <div class="col-md-4 mb-2">
                                    <p class="mb-1"><strong>Dept. (OU):</strong> 
                                        {% if payroll_data.company_info.dept and payroll_data.company_info.directorate %}
                                            {{ payroll_data.company_info.dept }} - {{ payroll_data.company_info.directorate }}
                                        {% elif payroll_data.company_info.dept %}
                                            {{ payroll_data.company_info.dept }}
                                        {% elif payroll_data.company_info.directorate %}
                                            {{ payroll_data.company_info.directorate }}
                                        {% endif %}
                                    </p>
                                    <p class="mb-1"><strong>Cost Center:</strong> {{ payroll_data.company_info.cost_center|default:'' }}</p>
                                </div>
                            </div>

                            <hr class="my-3">
                            
                            <!-- Salary Summary Section -->
                            <div class="row mb-3 bg-light p-3 rounded">
                                <div class="col-md-3">
                                    <p class="mb-1"><strong>Basic Salary:</strong> <span class="text-primary fw-bold">GH₵{{ payroll_data.basic_salary }}</span></p>
                                </div>
                                <div class="col-md-3">
                                    <p class="mb-1"><strong>Gross Pay:</strong> GH₵{{ payroll_data.gross_salary }}</p>
                                </div>
                                <div class="col-md-3">
                                    <p class="mb-1"><strong>Taxable Pay:</strong> GH₵{{ payroll_data.taxable_income }}</p>
                                </div>
                                <div class="col-md-3">
                                    <p class="mb-1"><strong>Net Salary:</strong> <span class="text-success fw-bold">GH₵{{ payroll_data.net_salary }}</span></p>
                                </div>
                            </div>
                        
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <p class="mb-1"><strong>SSF Contribution Employer:</strong> GH₵{{ payroll_data.employer_ssf }}</p>
                                </div>
                                <div class="col-md-4">
                                    <p class="mb-1"><strong>PF Contribution Employer:</strong> GH₵{{ payroll_data.employer_pf }}</p>
                                </div>
                                <div class="col-md-4">
                                    <p class="mb-1"><strong>Days:</strong> 28 days</p>
                                </div>
                            </div>
                            
                            <hr class="my-3">
                            
                            <!-- Allowances and Deductions Section -->
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <h5 class="fw-bold text-primary mb-3">Allowances / Special Earnings</h5>
                                    <table class="table table-bordered table-striped table-sm">
                                        <thead class="table-primary">
                                            <tr>
                                                <th>Type</th>
                                                <th class="text-end">Amount (GH₵)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td><strong>Basic Salary</strong></td>
                                                <td class="text-end fw-bold">{{ payroll_data.basic_salary }}</td>
                                            </tr>
                                            {% for income in payroll_data.incomes %}
                                            <tr>
                                                <td>{{ income.income_type }} {% if income.percentage_on_basic %}<small class="text-muted">({{ income.percentage_on_basic }}%)</small>{% endif %}</td>
                                                <td class="text-end">{{ income.entitled_amount }}</td>
                                            </tr>
                                            {% empty %}
                                            <tr><td colspan="2" class="text-center text-muted">No additional income records</td></tr>
                                            {% endfor %}
                                        </tbody>
                                        <tfoot>
                                            <tr class="table-success">
                                                <th>Total Allowances:</th>
                                                <th class="text-end">GH₵{{ payroll_data.total_income }}</th>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                        
                                <div class="col-md-6 mb-3">
                                    <h5 class="fw-bold text-danger mb-3">Deductions</h5>
                                    <table class="table table-bordered table-striped table-sm">
                                        <thead class="table-danger">
                                            <tr>
                                                <th>Type</th>
                                                <th class="text-end">Amount (GH₵)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% if payroll_data.income_tax and payroll_data.income_tax.tax %}
                                            <tr>
                                                <td>Income Tax</td>
                                                <td class="text-end">{{ payroll_data.income_tax.tax }}</td>
                                            </tr>
                                            {% endif %}
        
                                            {% if payroll_data.ssf_employee and payroll_data.ssf_employee.amount and payroll_data.ssf_employee.rate %}
                                            <tr>
                                                <td>Social Security <small class="text-muted">({{ payroll_data.ssf_employee.rate }}%)</small></td>
                                                <td class="text-end">{{ payroll_data.ssf_employee.amount }}</td>
                                            </tr>
                                            {% endif %}
        
                                            {% if payroll_data.pf_employee and payroll_data.pf_employee.rate and payroll_data.pf_employee.amount %}
                                            <tr>
                                                <td>PF Employee <small class="text-muted">({{ payroll_data.pf_employee.rate }}%)</small></td>
                                                <td class="text-end">{{ payroll_data.pf_employee.amount }}</td>
                                            </tr>
                                            {% endif %}
        
                                            {% if payroll_data.withholding_tax %}
                                            <tr>
                                                <td>Withholding Tax</td>
                                                <td class="text-end">{{ payroll_data.withholding_tax }}</td>
                                            </tr>
                                            {% endif %}
                                            
                                            {% if payroll_data.withholding_rent_tax %}
                                            <tr>
                                                <td>Withholding Rent Tax</td>
                                                <td class="text-end">{{ payroll_data.withholding_rent_tax }}</td>
                                            </tr>
                                            {% endif %}
                                            
                                            {% for deduction in payroll_data.deductions %}
                                            <tr>
                                                <td>{{ deduction.deduction_type }} {% if deduction.percentage_on_basic %}<small class="text-muted">({{ deduction.percentage_on_basic }}%)</small>{% endif %}</td>
                                                <td class="text-end">{{ deduction.deductable_amount }}</td>
                                            </tr>
                                            {% empty %}
                                            <tr><td colspan="2" class="text-center text-muted">No additional deductions</td></tr>
                                            {% endfor %}
                                        </tbody>
                                        <tfoot>
                                            <tr class="table-danger">
                                                <th>Total Deductions:</th>
                                                <th class="text-end text-danger fw-bold">GH₵{{ payroll_data.total_deduction }}</th>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>            
                            </div>
        
                            <!-- Benefits and Loans Section -->
                            <div class="row mt-4">
                                {% if payroll_data.benefits_in_kind and payroll_data.benefits_in_kind.total_bik and payroll_data.benefits_in_kind.total_bik > 0 %}
                                    <div class="col-md-6 mb-3">
                                        <h5 class="fw-bold text-info mb-3">Benefits In Kind</h5>
                                        <table class="table table-bordered table-striped table-sm">
                                            <thead class="table-info">
                                                <tr>
                                                    <th>Type</th>
                                                    <th class="text-end">Amount (GH₵)</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% if payroll_data.benefits_in_kind.rent_bik and payroll_data.benefits_in_kind.rent_bik > 0 %}
                                                <tr>
                                                    <td>Rent Element</td>
                                                    <td class="text-end">{{ payroll_data.benefits_in_kind.rent_bik }}</td>
                                                </tr>
                                                {% endif %}
        
                                                {% if payroll_data.benefits_in_kind.fuel_bik and payroll_data.benefits_in_kind.fuel_bik > 0 %}
                                                <tr>
                                                    <td>Fuel</td>
                                                    <td class="text-end">{{ payroll_data.benefits_in_kind.fuel_bik }}</td>
                                                </tr>
                                                {% endif %}
        
                                                {% if payroll_data.benefits_in_kind.vechile_bik and payroll_data.benefits_in_kind.vechile_bik > 0 %}
                                                <tr>
                                                    <td>Vehicle Allowance</td>
                                                    <td class="text-end">{{ payroll_data.benefits_in_kind.vechile_bik }}</td>
                                                </tr>
                                                {% endif %}
        
                                                {% if payroll_data.benefits_in_kind.driver_bik and payroll_data.benefits_in_kind.driver_bik > 0 %}
                                                <tr>
                                                    <td>Driver's Allowance</td>
                                                    <td class="text-end">{{ payroll_data.benefits_in_kind.driver_bik }}</td>
                                                </tr>
                                                {% endif %}
                                            </tbody>
                                            <tfoot>
                                                <tr class="table-info">
                                                    <th>Total Benefits In Kind:</th>
                                                    <th class="text-end">GH₵{{ payroll_data.benefits_in_kind.total_bik }}</th>
                                                </tr>
                                            </tfoot>
                                        </table>
                                    </div>
                                {% endif %}
        
                                {% if payroll_data.loan_details %}
                                    <div class="col-md-6 mb-3">
                                        <h5 class="fw-bold text-warning mb-3">Loan Details</h5>
                                        <table class="table table-bordered table-striped table-sm">
                                            <thead class="table-warning">
                                                <tr>
                                                    <th>Loan Type</th>
                                                    <th class="text-end">Principal</th>
                                                    <th class="text-end">Paid</th>
                                                    <th class="text-end">Outstanding</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for loan in payroll_data.loan_details %}
                                                    <tr>
                                                        <td>{{ loan.type }}</td>
                                                        <td class="text-end">{{ loan.meta.principal_amount }}</td>
                                                        <td class="text-end">{{ loan.meta.amount_paid }}</td>
                                                        <td class="text-end fw-bold">{{ loan.meta.outstanding_balance }}</td>
                                                    </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                {% endif %}
                            </div>
                            
                            <!-- Footer -->
                            <div class="mt-4 pt-3 border-top">
                                <div class="row">
                                    <div class="col-6 text-center">
                                        <p class="text-muted small mb-0">Generated on: {% now "F j, Y" %}</p>
                                    </div>
                                    <div class="col-6 text-center">
                                        <p class="text-muted small mb-0">© Central University Payroll System</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="alert alert-info">
            <p class="mb-0">Please select a month to view all Staff Payslips.</p>
        </div>
    {% endif %}
    
    <!-- Bootstrap JS (optional for PDF, but included for completeness) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>