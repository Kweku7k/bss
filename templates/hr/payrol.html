{% comment %} {% include "partials/_staffdetails_sidebar.html" %} {% endcomment %}
{% include "partials/_topnav.html" %} 
{% load static %}

{% if messages %}
<div class="toast-container position-fixed bottom-0 end-0 p-3">
    {% for message in messages %}
    <div id="toast{{ forloop.counter }}" class="toast show bg-{{ message.tags }}" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="10000">
        <div class="toast-header text-white bg-{{ message.tags }}">
            <strong class="me-auto">{{ message.tags|title }}</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body text-white">
            {{ message }}
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

<div class="row">
    <div class="col-md-3 mt-4">
        {% include "partials/_staffdetails_sidebar.html" %} 
    </div>

    <div class="col-md-8 mt-3 py-5 ">

{% comment %} <div class="container mt-3 py-5 "> {% endcomment %}

    <div class="card shadow border-0 mb-4 p-3">
        <div class="card-body">

          <div class="text-center mb-4">
            <img src="/media/images/fav.png" alt="Logo" width="80">
            <h3 class="fw-bold text-uppercase">Central University</h3>
            {% if payroll_data.month %}
            <h5 class="text-muted">Payslip for {{ payroll_data.month }}</h5>
            {% endif %}
          </div>

          
          <div class="row mb-2">
            <div class="col-5">
              <div class="mb-4">
                  <form method="get">
                      <div class="input-group">
                          <label class="input-group-text" for="month">Select Month:</label>
                          <input class="form-control" type="date" name="month" id="month" required>
                          <button type="submit" class="btn btn-primary">View Payroll</button>
                      </div>
                  </form>
              </div>
            </div>
          </div>

          <button onclick="window.print()" class="btn btn-outline-secondary text-end mb-3">
            üñ®Ô∏è Print Payslip
          </button>
          
          <hr/>
            <div class="row">
                <div class="col-md-3">
                    <p><strong>Name:</strong> {{ staff.title }} {{ staff.fname }} {{ staff.lname }} {{ staff.middlenames }}</p>
                    <p><strong>Employee ID:</strong> {{ staff.staffno }}</p>                    
                </div>
                <div class="col-md-3">
                  <p><strong>SS No.:</strong> {{ staff.ssnitno|default:'' }}</p>
                  <p><strong>Job Title:</strong> {{ company_info.job_title|default:'' }}</p>
                </div>
                <div class="col-md-3">
                  <p><strong>Grade:</strong> {{ company_info.grade|default:'' }}</p>
                  <p><strong>Notch:</strong> {{ company_info.notch|default:'' }}</p>                
                </div>
                <div class="col-md-3">
                  <p><strong>Bank:</strong> {{ company_info.bank_name|default:'' }}</p>
                  <p><strong>Bank Branch:</strong> {{ company_info.bank_branch|default:'' }}</p>
                </div>
                <div class="col-md-3">
                  <p><strong>Bank A/C No:</strong> {{ company_info.accno|default:'' }}</p>
                  <p><strong>Email Address:</strong> {{ company_info.email|default:'' }}</p>
                </div>
                <div class="col-md-6">
                  <p><strong>Dept. (OU):</strong> 
                    {% if company_info.dept and company_info.directorate %}
                        <p>{{ company_info.dept }} - {{ company_info.directorate }}</p>
                    {% elif company_info.dept %}
                        <p>{{ company_info.dept }}</p>
                    {% elif company_info.directorate %}
                        <p>{{ company_info.directorate }}</p>
                    {% endif %}
                  </p>
                  <p><strong>Cost Center:</strong> {{ company_info.cost_center|default:'' }}</p>                
                </div>
            </div>
        </div>
    </div>

    {% if payroll_data %}
    <div class="card shadow border-0 mb-4 p-3">
      <div class="card-body">
    <div class="row">
        <div class="col-md-6">
            <h5 class="fw-bold">Allowances / Special Earnings</h5>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Type</th>
                        <th class="text-end">Amount (GH‚Çµ)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Basic Salary</strong></td>
                        <td class="text-end">{{ payroll_data.basic_salary }}</td>
                    </tr>
                    {% for income in payroll_data.incomes %}
                    <tr>
                        <td>{{ income.income_type }}</td>
                        <td class="text-end">{{ income.amount }}</td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="2">No income records</td></tr>
                    {% endfor %}
                </tbody>
            </table>
            <p><strong>Total Allowances:</strong> GH‚Çµ{{ payroll_data.total_income }}</p>
        </div>

        <div class="col-md-6">
            <h5 class="fw-bold">Deductions</h5>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Type</th>
                        <th class="text-end">Amount (GH‚Çµ)</th>
                    </tr>
                </thead>
                <tbody>
                    {% if payroll_data.income_tax %}
                    <tr>
                        <td>Income Tax</td>
                        <td class="text-end">{{ payroll_data.income_tax.tax }}</td>
                    </tr>
                    {% endif %}
                    {% if payroll_data.ssf_employee %}
                    <tr>
                        <td>Social Security ({{ payroll_data.ssf_employee.rate }}%)</td>
                        <td class="text-end">{{ payroll_data.ssf_employee.amount }}</td>
                    </tr>
                    {% endif %}
                    {% if payroll_data.pf_employee %}
                    <tr>
                        <td>PF Employee</td>
                        <td class="text-end">{{ payroll_data.pf_employee }}</td>
                    </tr>
                    {% endif %}
                    {% for deduction in payroll_data.deductions %}
                    <tr>
                        <td>{{ deduction.deduction_type }}</td>
                        {% if deduction.percentage_of_basic %}
                            <td class="text-end">{{ deduction.percentage_of_basic }}%</td>
                        {% else %}
                            <td class="text-end">{{ deduction.amount }}</td>
                        {% endif %}
                    </tr>
                    {% empty %}
                    <tr><td colspan="2">No deductions</td></tr>
                    {% endfor %}
                </tbody>
            </table>
            <p><strong>Total Deductions:</strong><span class="text-danger fw-bold"> GH‚Çµ{{ payroll_data.total_deduction }} </span></p>
        </div>
    </div>
    </div>
  </div>

    <hr>
    <div class="row">
        <div class="col-md-3">
          <p><strong>Basic Salary:</strong><span class="text-primary fw-bold">  GH‚Çµ{{ payroll_data.basic_salary }}<span/></p>
        </div>
        <div class="col-md-3">
            <p><strong>Gross Pay:</strong> GH‚Çµ{{ payroll_data.gross_salary }}</p>
        </div>
        <div class="col-md-3">
            <p><strong>Taxable Pay:</strong> GH‚Çµ{{ payroll_data.taxable_income }}</p>
        </div>
        <div class="col-md-3">
            <p><strong>Net Salary:</strong> <span class="text-success fw-bold">GH‚Çµ{{ payroll_data.net_salary }}</span></p>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <p><strong>SSF Contribution Employer:</strong> GH‚Çµ{{ payroll_data.employer_ssf }}</p>
        </div>
        <div class="col-md-6">
            <p><strong>PF Contribution Employer:</strong> GH‚Çµ{{ payroll_data.employer_pf }}</p>
        </div>
    </div>
    {% endif %}
</div>
