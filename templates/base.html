{% load static %}
{% include "partials/_topnav.html" %}
{% include "partials/_sidebar.html" %}
<main id="main" class="main" style="background-color: #f8f9fa;">

   <!-- Toast for success or error messages -->
   {% if messages %}
      <div class="toast-container position-fixed bottom-0 end-0 p-3">
         {% for message in messages %}
            <div id="toast{{ forloop.counter }}" class="toast {{ message.tags }} bg-{{ message.tags }}" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="10000">
               <div class="toast-header text-white bg-{{ message.tags }}">
                  <strong class="me-auto">{{ message.tags|title }}</strong>
                  <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
               </div>
               <div class="toast-body text-white">
                  {{ message }}
               </div>
            </div>
         {% endfor %}
      </div>
   {% endif %}

   <!-- Session Warning Toast -->
<div class="toast-container position-fixed bottom-0 end-0 p-3">
  <div id="sessionWarningToast" class="toast bg-danger text-white" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="15000">
    <div class="toast-header bg-danger text-white">
      <strong class="me-auto">Session Warning</strong>
      <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
    <div class="toast-body">
      Your session will expire in 10 minutes. Please save your work.
    </div>
  </div>
</div>


   {% block content %}
   <!-- Your content goes here -->
   {% endblock %}

   {% include "partials/_footer.html" %}
   
</main>

<!-- Include Bootstrap JS and Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>


<script>
   // Wait until the DOM is fully loaded
   document.addEventListener('DOMContentLoaded', function () {
      // Loop through and show all the toasts for each message
      {% for message in messages %}
         const toastEl{{ forloop.counter }} = document.getElementById('toast{{ forloop.counter }}');
         if (toastEl{{ forloop.counter }}) {
            const toast{{ forloop.counter }} = new bootstrap.Toast(toastEl{{ forloop.counter }});
            toast{{ forloop.counter }}.show();
         }
      {% endfor %}
   });
</script>

<script>
  const sessionRemaining = {{ session_remaining_seconds|default:0 }};
  const warningTime = 5 * 60; // 5 minutes
  const endTime = Date.now() + sessionRemaining * 1000;

  function checkSessionTime() {
    const now = Date.now();
    const remaining = endTime - now;

    if (remaining <= warningTime * 1000 && !window.warned) {
      window.warned = true;

      const toastEl = document.getElementById('sessionWarningToast');
      if (toastEl) {
        const toast = new bootstrap.Toast(toastEl);
        toast.show();
      }
    }
  }

  setInterval(checkSessionTime, 10000); // every 10 seconds
</script>


